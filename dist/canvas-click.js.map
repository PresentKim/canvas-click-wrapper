{"version":3,"file":"canvas-click.js","sources":["../src/canvas-click.ts"],"sourcesContent":["type FlattenArrayMap<T> = T[keyof T] extends any[] ? T[keyof T][number] : never;\n\nfunction findKeyOfArrayMap<T, V extends ReadonlyArray<U>, U>(map: { [key: string]: V }, el: U): string | undefined {\n    for (const key in map) {\n        if (map[key].includes(el)) {\n            return key;\n        }\n    }\n    return undefined;\n}\n\nconst CanvasClickEventMap = {\n    start: [\"mousedown\", \"touchstart\"],\n    move: [\"mousemove\", \"touchmove\"],\n    end: [\"mouseup\", \"touchend\", \"touchcancel\"]\n} as const;\ntype CanvasClickEvents = keyof typeof CanvasClickEventMap;\ntype DomClickEvents = FlattenArrayMap<typeof CanvasClickEventMap>;\n\ntype IClickInfo = {\n    identifier?: number;\n    pageX: number;\n    pageY: number;\n}\n\ntype CanvasClickListener<R> = (click: CanvasClick, type: CanvasClickEvents) => R;\n\nexport default class CanvasClick implements IClickInfo {\n    public constructor(\n            public readonly identifier: number,\n            public readonly pageX: number,\n            public readonly pageY: number,\n            public readonly x: number,\n            public readonly y: number,\n    ) {\n    }\n\n    public static addClickListener<R>(types: CanvasClickEvents | CanvasClickEvents[], canvas: HTMLCanvasElement, listener: CanvasClickListener<R>, target: HTMLElement = canvas): void {\n        for (const type of types instanceof Array ? types : [types]) {\n            for (const eventType of CanvasClickEventMap[type]) {\n                target.addEventListener(eventType as DomClickEvents, CanvasClick.wrap(canvas, listener));\n            }\n        }\n    }\n\n    public static wrap<T, R>(\n            canvas: HTMLCanvasElement,\n            listener: CanvasClickListener<R>,\n            thisArgs?: T,\n    ): (this: T, event: MouseEvent | TouchEvent) => any {\n        return (event: MouseEvent | TouchEvent) => {\n            const type = findKeyOfArrayMap(CanvasClickEventMap, event.type) as CanvasClickEvents | undefined;\n            if (type === undefined) {\n                throw new Error(`Unknown event type: ${event.type}`);\n            }\n            if (event instanceof MouseEvent) {\n                if (event.button === 0) {\n                    listener.call(thisArgs, CanvasClick.from(canvas, event), type);\n                }\n            } else if (event instanceof TouchEvent) {\n                const length = event.changedTouches.length;\n                for (let i = 0; i < length; ++i) {\n                    listener.call(thisArgs, CanvasClick.from(canvas, event.changedTouches[i]), type);\n                }\n            }\n        }\n    }\n\n    public static from(canvas: HTMLCanvasElement, clickInfo: IClickInfo): CanvasClick {\n        const canvasBounds = canvas.getBoundingClientRect();\n        return new CanvasClick(\n                clickInfo.identifier ?? 0,\n                clickInfo.pageX,\n                clickInfo.pageY,\n                (clickInfo.pageX - canvasBounds.left - window.scrollX) / (canvas.clientWidth / (canvas.width || canvas.clientWidth)),\n                (clickInfo.pageY - canvasBounds.top - window.scrollY) / (canvas.clientHeight / (canvas.height || canvas.clientHeight))\n        );\n    }\n}"],"names":[],"mappings":"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"}